# Проектирование высоконагруженных систем
## Notion

## Содержание
[1. Тема и целевая аудитория](#1-тема-и-целевая-аудитория)

## 1. Тема и целевая аудитория
Notion - это сервис для создания заметок и текстовых документов, канбан-карт, гибких баз данных и баз знаний, трекинга задач и управления проектами.

### Функционал MVP:
- авторизация
- профиль пользователя
- главная страница
- создание и редактирование контента
- совместное редактирование
- поиск по страницам
- недавние и избранные страницы
- вложенные страницы с иерархией
- прикрепление вложений
- автосохранение
- ACL, права доступа

### Целевая аудитория
По данным сайта [hypestat](https://hypestat.com/info/notion.so) Notion имеет следующие метрики:
- более 5 млн уникальных пользователей в день (DAU)
- более 25.5 млн уникальных пользователей в месяц (MAU) и 170 млн сессий в месяц (~7 визитов на пользователя)
- около 20% пользователей заходят в сервис ежедневно (stickness, DAU/MAU)
- среднее время сессии пользователя - 9 минут
- в среднем пользователь за сессию просматривает около 10 страниц
- bounce rate сервиса - около 25% пользователей покидают сайт, не совершая никаких взаимодействий

## Анализ аудитории

#### География пользователей
![img.png](images/user_geography.png)

#### Устройства пользователей
![img.png](images/devices.png)

## 2. Расчет нагрузки

### Расчет объема сохраняемых данных
В 2024 году Notion достиг отметки 100 млн пользователей[^1]. Исходя из этого можно оценить объем сохраняемых данных.

| хранимые данные           | средний размер единицы | ед/пользователь | сколько единиц | суммарный объем  |
|---------------------------|------------------------|:---------------:|----------------|------------------|
| профиль пользователя      | 300 Кб                 |        1        | 100 млн         | 30 Тб            | 
| страницы (без вложений)   | 200 Кб (~25k слов)                 |       10        | 1 млрд        | 200 Тб           |
| вложения                  | 1 Мб                   |       40        | 4 млрд       | 4 Пб           |

Суммарный объем данных составляет 4230 Тб, из которых 4000 Тб - хранилище вложений.

### Расчет среднего количества действий пользователя в день и RPS
Кажется, данных по количеству действий пользователей в день нет в открытом доступе. Поэтому я буду использовать данные, исходя из своего опыта использования Notion и некоторых данных с [hypestat](https://hypestat.com/info/notion.so).

Публичных данных по действиям пользователя в день нет, поэтому я опираюсь на свой опыт использования Notion и агрегированные метрики с [hypestat](https://hypestat.com/info/notion.so). Пользователь в среднем просматривает ~9.5 страниц за сессию. По дневной агрегации Daily Visits ≈ Daily Unique Visitors, что даёт ~1 визит на активного пользователя в день. Чтобы учесть мультидевайс/возвраты в течение дня, можно ввести небольшой мультипликатор _p_ и принять 1.12 сессии/DAU/день (то есть 1+p, где p=0.12).

Из принятых допущений для MVP получаем ~10.6 страниц/день на DAU. Для расчета RPS будем использовать формулу

$$RPS = \frac{\text{среднее действий в день на пользователя} \times DAU}{86\,400}$$

## Источники
[^1]: https://www.notion.com/blog/100-million-of-you
